{"ast":null,"code":"var _jsxFileName = \"/Users/jonphillips/Desktop/tanda/react/adnat-react/frontend/src/components/Home.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport { Link } from 'react-router-dom';\nimport Organisations from './Organisations';\nconst baseAPI = \"http://localhost:3000\";\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: {},\n      organisations: [],\n      organisation: {},\n      sessionId: ''\n    }; // BINDING GOES HERE\n\n    this.fetchUser = this.fetchUser.bind(this);\n    this.handleLogout = this.handleLogout.bind(this);\n    this.fetchOrganisations = this.fetchOrganisations.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleLeave = this.handleLeave.bind(this);\n  }\n\n  fetchUser() {\n    if (this.props.location.state) {\n      const sessionId = this.props.location.state.sessionId;\n      this.setState({\n        sessionId\n      });\n      const headers = {\n        'Authorization': sessionId\n      };\n      axios.get(baseAPI + \"/users/me\", {\n        headers\n      }).then(response => {\n        this.setState({\n          user: response.data\n        });\n        console.log(this.state.user);\n      });\n    } else {\n      this.props.history.push({\n        pathname: '/'\n      });\n    }\n  }\n\n  handleLogout() {\n    console.log('logging out');\n    axios.delete(baseAPI + \"/auth/logout\", {\n      headers: {\n        'Authorization': this.state.sessionId\n      }\n    }).then(response => {\n      if (response.status === 200) {\n        this.setState({\n          user: {},\n          organisations: [],\n          organisation: {},\n          sessionId: ''\n        });\n        alert(\"Logged out successfully!\");\n        this.props.history.push({\n          pathname: '/'\n        });\n      }\n    });\n  }\n\n  fetchOrganisations() {\n    console.log('fetching organisations');\n\n    if (this.props.location.state) {\n      const sessionId = this.props.location.state.sessionId;\n      this.setState({\n        sessionId\n      });\n      const headers = {\n        'Authorization': sessionId\n      };\n      axios.get(baseAPI + \"/organisations\", {\n        headers\n      }).then(response => {\n        const user = this.state.user;\n        const organisation = response.data.find(organisation => organisation.id === user.organisationId);\n        console.log(organisation);\n        this.setState({\n          organisations: response.data,\n          organisation\n        });\n        this.props.history.push(\"/home\");\n      });\n    }\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    console.log('creating and joining organisation');\n    const sessionId = this.state.sessionId;\n    const headers = {\n      'Authorization': sessionId\n    };\n    axios.post(baseAPI + \"/organisations/create_join\", {\n      name: event.target.name.value,\n      hourlyRate: event.target.rate.value\n    }, {\n      headers\n    }).then(this.fetchOrganisations());\n    console.log('organisation created and joined');\n  }\n\n  handleLeave() {\n    console.log('leaving organisation');\n    axios.post(baseAPI + \"/organisations/leave\", null, {\n      headers: {\n        'Authorization': this.state.sessionId\n      }\n    }).then(response => {\n      console.log(response);\n      console.log('organisation left');\n    }).then(this.setState({\n      organisation: {}\n    }));\n    this.props.history.push(\"/home\");\n  }\n\n  componentDidMount() {\n    this.fetchUser();\n    this.fetchOrganisations();\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/home\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }, \"Tanda Challenge\"))), React.createElement(\"div\", {\n      className: \"home\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, \" Home \"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, \"Logged in as \", this.state.user.name, \".\", React.createElement(\"button\", {\n      onClick: this.handleLogout,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, \"Log out\")), this.state.user.organisationId === null ? React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, \"You aren't a member of any organisations.\", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }), \"Join an exisiting one or create a new one.\") : '', this.state.organisations.length > 0 ? React.createElement(\"div\", {\n      className: \"organisations\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }, \" Organisations \"), React.createElement(Organisations, {\n      organisations: this.state.organisations,\n      user: this.state.user,\n      sessionId: this.state.sessionId,\n      handleLogout: this.handleLogout,\n      organisation: this.state.organisation,\n      fetchUser: this.fetchUser,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    })) : React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, \" \"), React.createElement(\"div\", {\n      className: \"create-organisation\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }, \" Create organisation \"), React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, \"Name:\"), React.createElement(\"input\", {\n      type: \"text\",\n      name: \"name\",\n      id: \"name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      htmlFor: \"rate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, \"Hourly rate: $\"), React.createElement(\"input\", {\n      type: \"text\",\n      name: \"rate\",\n      id: \"rate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }, \"per hour\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, \" Create and Join \"))), React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }, this.state.user.organisationId ? React.createElement(\"div\", {\n      className: \"my-organisation\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, this.state.organisation.name), React.createElement(Link, {\n      to: {\n        pathname: \"/shifts\",\n        state: {\n          organisation: this.state.organisation,\n          user: this.state.user,\n          sessionId: this.state.sessionId\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, \"View Shifts\"), React.createElement(Link, {\n      to: {\n        pathname: \"/edit\",\n        state: {\n          organisation: this.state.organisation,\n          user: this.state.user,\n          sessionId: this.state.sessionId\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, \"Edit\"), React.createElement(Link, {\n      to: \"/home\",\n      onClick: this.handleLeave,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, \"Leave\")) : React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, \" \"))));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["/Users/jonphillips/Desktop/tanda/react/adnat-react/frontend/src/components/Home.js"],"names":["React","Component","axios","Link","Organisations","baseAPI","Home","constructor","props","state","user","organisations","organisation","sessionId","fetchUser","bind","handleLogout","fetchOrganisations","handleSubmit","handleLeave","location","setState","headers","get","then","response","data","console","log","history","push","pathname","delete","status","alert","find","id","organisationId","event","preventDefault","post","name","target","value","hourlyRate","rate","componentDidMount","render","length"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport { Link } from 'react-router-dom';\n\nimport Organisations from './Organisations';\n\nconst baseAPI = `http://localhost:3000`;\n\nclass Home extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      user: {},\n      organisations: [],\n      organisation: {},\n      sessionId: ''\n    }\n    // BINDING GOES HERE\n    this.fetchUser = this.fetchUser.bind(this)\n    this.handleLogout = this.handleLogout.bind(this)\n    this.fetchOrganisations = this.fetchOrganisations.bind(this)\n    this.handleSubmit = this.handleSubmit.bind(this)\n    this.handleLeave = this.handleLeave.bind(this)\n  }\n\n  fetchUser() {\n    if(this.props.location.state) {\n      const { sessionId } = this.props.location.state\n      this.setState({ sessionId })\n      const headers = { 'Authorization': sessionId }\n      axios.get(baseAPI + `/users/me`, { headers })\n        .then(response => {\n          this.setState({ user: response.data })\n          console.log(this.state.user)\n        })\n    }\n    else {\n      this.props.history.push({\n        pathname: '/'\n      })\n    }\n  }\n\n  handleLogout() {\n    console.log('logging out')\n    axios.delete(baseAPI + `/auth/logout`, {\n      headers: {\n        'Authorization': this.state.sessionId\n      }\n    })\n    .then(response => {\n      if(response.status === 200) {\n        this.setState({\n          user: {},\n          organisations: [],\n          organisation: {},\n          sessionId: ''\n        })\n        alert(\"Logged out successfully!\")\n        this.props.history.push({\n          pathname: '/'\n        })\n      }\n    })\n  }\n\n  fetchOrganisations() {\n    console.log('fetching organisations')\n    if(this.props.location.state) {\n      const { sessionId } = this.props.location.state\n      this.setState({ sessionId })\n      const headers = { 'Authorization': sessionId }\n      axios.get(baseAPI + `/organisations`, { headers })\n      .then(response => {\n        const { user } = this.state\n        const organisation = response.data.find(organisation => organisation.id === user.organisationId)\n        console.log(organisation)\n        this.setState({\n          organisations: response.data, organisation\n        })\n        this.props.history.push(`/home`)\n      })\n    }\n  }\n\n  handleSubmit(event) {\n    event.preventDefault()\n    console.log('creating and joining organisation')\n    const { sessionId } = this.state\n    const headers = { 'Authorization': sessionId }\n    axios.post(baseAPI + `/organisations/create_join`, {\n      name: event.target.name.value,\n      hourlyRate: event.target.rate.value\n    },\n    { headers })\n    .then(\n      this.fetchOrganisations(),\n    )\n    console.log('organisation created and joined')\n  }\n\n  handleLeave() {\n    console.log('leaving organisation')\n    axios.post(baseAPI + `/organisations/leave`, null, { headers: { 'Authorization': this.state.sessionId } })\n    .then(response => {\n      console.log(response)\n      console.log('organisation left')\n    })\n    .then(\n      this.setState({\n        organisation: {}\n      })\n    )\n    this.props.history.push(`/home`)\n  }\n\n  componentDidMount() {\n    this.fetchUser()\n    this.fetchOrganisations()\n  }\n\n  render() {\n    return(\n      <div className='container'>\n        <div className='header'>\n          <h1>\n            <Link to='/home'>\n              Tanda Challenge\n            </Link>\n          </h1>\n        </div>\n        <div className='home'>\n          <h2> Home </h2>\n          <p>\n            Logged in as {this.state.user.name}.\n            <button onClick={this.handleLogout}>\n              Log out\n              </button>\n            </p>\n            { this.state.user.organisationId === null\n              ?\n              <p>\n                You aren't a member of any organisations.\n                <br />\n                Join an exisiting one or create a new one.\n              </p>\n              : ''\n            }\n            {\n              this.state.organisations.length > 0\n              ?\n            <div className='organisations'>\n              <h3> Organisations </h3>\n              <Organisations\n                organisations={this.state.organisations}\n                user={this.state.user}\n                sessionId={this.state.sessionId}\n                handleLogout={this.handleLogout}\n                organisation={this.state.organisation}\n                fetchUser={this.fetchUser}\n              />\n            </div>\n            :\n            <span> </span>\n          }\n\n\n          <div className='create-organisation'>\n            <h3> Create organisation </h3>\n            <form onSubmit={this.handleSubmit}>\n              <label htmlFor=\"name\">\n                Name:\n              </label>\n              <input\n                type=\"text\"\n                name=\"name\"\n                id=\"name\"\n              />\n              <br />\n              <label htmlFor=\"rate\">\n                Hourly rate: $\n              </label>\n              <input\n                type=\"text\"\n                name=\"rate\"\n                id=\"rate\"\n              />\n              <span>\n                per hour\n              </span>\n              <br />\n              <button type=\"submit\"> Create and Join </button>\n            </form>\n          </div>\n          <React.Fragment>\n            {\n              this.state.user.organisationId\n              ?\n              <div className=\"my-organisation\">\n                <h3>\n                  {this.state.organisation.name}\n                </h3>\n                <Link to={{\n                  pathname: `/shifts`,\n                  state: {\n                    organisation: this.state.organisation,\n                    user: this.state.user,\n                    sessionId: this.state.sessionId\n                  }\n                }}>\n                  View Shifts\n                </Link>\n                <Link to={{\n                  pathname: `/edit`,\n                  state: {\n                    organisation: this.state.organisation,\n                    user: this.state.user,\n                    sessionId: this.state.sessionId }\n                  }}>\n                  Edit\n                </Link>\n                <Link\n                  to='/home'\n                  onClick={this.handleLeave}\n                >\n                  Leave\n                </Link>\n              </div>\n              : <span> </span>\n            }\n          </React.Fragment>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}